## Redis 相关内容





#### Redis 持久化方案
##### 快照持久化 

> 快照持久化方案会将某一时刻的所有数据都写入到硬盘中


`redis.conf`
```
save 60 1000 
dbfilename dump.rdb 
dir 
```

###### 缺陷 
- 会丢失部分数据 例如 ：如果redis宕机会导致 最后一次快照执行之后的数据丢失 

###### 创建快照的方法
- 客户端发送`BGSAVE`命令创建快照， `redis`嗲用fork来创建一个子线程复制将快照写入硬盘，**父进程则继续处理命令**
- 客户端发送`SAVE`命令创建快照，在创建完快照之前 ，**父进程不接受任何命令** 
- 在`redis.conf`设置 save 的配置选项 例如 save 60 10000 ，则表示 在最近一次创建快照之后开始算起 **60秒之内有10000次写入** 则 redis 会自动触发`BGSAVE` 命令 ，如果设置多个，满足其中一个就会被执行
- 当Aredis服务器连接Bredis服务器，向B服务器发送SYNC的命令来开始一次复制操作的时候，如果主服务器没有执行`BGSAVE`，那么主服务器就会执行`BGSAVE`命令




##### AOF 持久化(Append Only file)

> 只追加文件持久化方案,会在执行`写命令`的时候，将`写命令`命令复制到硬盘中

###### 缺点 
- 


###### 一些东西
- `redis.conf` 修改 appendonly yes 开启  aof 
- 


#### Redis如何淘汰过期的keys

- 主动 
    > 当客户端访问某一个key的时候，如果key过期了，则会被删除 
    > 缺点：如果一些key不被访问则内存占用越大
- 被动 
    > 为了节省内容，redis 使用了被动模式，
    > 即：redis 每10秒钟做的事情
    > 1.测试随机的20个keys进行相关过期检测。
    > 2.删除所有已经过期的keys。 
    > 3.如果有多于25%的keys过期，重复步奏1.



